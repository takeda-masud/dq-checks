dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_121,unit_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_redist_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 121) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 121) and upper(sa.franchise_nm)='HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 121) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,1
dq_122,unit_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_dir_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 122) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 122) and upper(sa.franchise_nm)='HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 122) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,2
dq_123,unit_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_udef_order_adjs sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 122) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 122) and upper(sa.franchise_nm)='HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 122) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,3
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_121','dq_122','dq_123')",P1,0,4
dq_221,product_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_redist_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 221) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 221) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 221) prv on cur.product=prv.product) select * from tmp",P1,10,5
dq_222,product_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_dir_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 222) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 222) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 222) prv on cur.product=prv.product) select * from tmp",P1,10,6
dq_223,product_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_udef_order_adjs sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 223) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 223) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 223) prv on cur.product=prv.product) select * from tmp",P1,10,7
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_221','dq_222','dq_223')",P1,0,8
