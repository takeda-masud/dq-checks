dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_221,product_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_redist_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 221) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 221) and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by pr.brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 221) prv on cur.product=prv.product) select * from tmp",P1,10,101
dq_222,product_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_dir_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 222) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 222) and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by pr.brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 222) prv on cur.product=prv.product) select * from tmp",P1,10,102
dq_421,channel_name_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_redist_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 421) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 421)  and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 421) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,103
dq_422,channel_name_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_dir_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 422) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 422) and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 422) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,104
dq_521,channel_type_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, chnl_typ as channel_type from com_us_hub.txn_redist_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 521) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 521)  and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by chnl_typ) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as  channel_type from com_us_lake.dq_count_table where rule_key = 521) prv on cur. channel_type=prv. channel_type) select * from tmp",P1,10,105
dq_522,channel_type_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, chnl_typ as channel_type from com_us_hub.txn_dir_sls sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 522) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 522)   and upper(sa.franchise_nm) IN ('HEMATOLOGY','IMMUNOLOGY') group by chnl_typ) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as  channel_type from com_us_lake.dq_count_table where rule_key = 522) prv on cur. channel_type=prv. channel_type) select * from tmp",P1,10,106
dq_721,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 721) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 721) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 721) prv on cur.region = prv.region) select * from tmp",P1,10,107
dq_722,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 722) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 722)   group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 722) prv on cur.region = prv.region) select * from tmp",P1,10,108
dq_723,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 723) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 723)  group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 723) prv on cur.region = prv.region) select * from tmp",P1,10,109
dq_724,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, region from 
(select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 
union 
select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 
union 
select sls_key,gl_date,area_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (case when extract(month from date_add(current_date, 1)) = extract(month from current_date) then trunc(add_months(current_date, -26), 'mm') else trunc(add_months(current_date, -25), 'mm')end) and (case when extract(month from date_add(current_date, 1)) = extract(month from current_date) then date_add(trunc(add_months(current_date, -2), 'mm'), -1) else date_add(trunc(add_months(current_date, -1), 'mm'), -1) end) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 724) prv on cur.region = prv.region) select * from tmp",P1,10,110
dq_821,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 821) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 821) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 821) prv on cur.territory = prv.territory) select * from tmp",P1,20,111
dq_822,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 822) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 822)  group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 822) prv on cur.territory = prv.territory) select * from tmp",P1,20,112
dq_823,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 823) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 823) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 823) prv on cur.territory = prv.territory) select * from tmp",P1,20,113
dq_824,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs(((cur_cnt-prv_cnt)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_direct_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm  IN ('HEMATOLOGY','IMMUNOLOGY') and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 824) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 824) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 824) prv on cur.territory = prv.territory) select * from tmp",P1,20,114
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when round(metric,2) > threshold then 1 else 0 end as res from dq_output_table
 where entity_id in('dq_221','dq_222','dq_421','dq_422','dq_521','dq_522','dq_721','dq_722','dq_723','dq_724','dq_821','dq_822','dq_823','dq_824')",P1,0,115
