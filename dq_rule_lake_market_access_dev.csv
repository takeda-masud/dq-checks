dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_20111,Blank_prod_id,com_us_lake,dagg_cdit_redist,row_id,"with dagg_cdit_redist as 
(select product_name,contract_id,parent_customer,aud_row_stat_ind from  com_us_lake.dagg_cdit_redist    WHERE  aud_row_stat_ind='0'
--union  select product_name,contract_id,parent_customer,aud_row_stat_ind FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'
 ) select count(*) FROM dagg_cdit_redist  a
 left join 
( SELECT  prod_id
FROM com_us_hub.ref_prd_prod prd
WHERE aud_row_stat_ind='0' group by prod_id) prd
on a.product_name=prd.prod_id 
 left join 
   com_us_lake.udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    com_us_lake.udef_na_hierarchy c on 
   a.contract_id=c.contract_id
    left join 
   com_us_lake.udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
     where COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP'
  and prd.prod_id is null	",P1,0,1
dq_20112,Blank_prod_id,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp as(

SELECT 
count(*)
FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN com_us_lake.bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
         left join 
      
        (SELECT 
regexp_replace(udef_ndc_hier.product_code,""^0+(?!$)"","""") as prod_cod,
udef_ndc_hier.reporting_group FROM com_us_lake.udef_ndc_hier WHERE (udef_ndc_hier.aud_row_status_ind='0')  )
on prod_cod=regexp_replace(BPRI_BillingExtract.MATERIAL,""^0+"","""") 
          where channel_type='SPP'
          
          and regexp_replace(BPRI_BillingExtract.MATERIAL,""^0+"","""")  is  null )
          select * from tmp",P1,0,2
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20111','dq_20112')",P1,0,3
dq_20211,Blank_Reporting_group,com_us_lake,dagg_cdit_redist,row_id,"
with  dagg_cdit_redist as
(select contract_id, parent_customer,ndc_code  from 
com_us_lake.dagg_cdit_redist a where    aud_row_stat_ind='0'  ) ,
udef_na_hierarchy as
( select channel_type,flex_cust_number,contract_id from com_us_lake.udef_na_hierarchy  group by channel_type,flex_cust_number,contract_id)
  

select     
  
count(ndc_code) 

from  dagg_cdit_redist a
 left join 
   udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
  where  COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP'  
 and   NULLIF(TRIM(ndc_code), '')    is null",P1,0,4
dq_20212,Blank_Reporting_group,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp as
(SELECT 
 count(*)

FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN com_us_lake.bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
         left join 
      
        (SELECT 
regexp_replace(udef_ndc_hier.product_code,""^0+(?!$)"","""") as prod_cod,
udef_ndc_hier.reporting_group FROM com_us_lake.udef_ndc_hier WHERE (udef_ndc_hier.aud_row_status_ind='0')  )
on prod_cod=regexp_replace(BPRI_BillingExtract.MATERIAL,""^0+"","""") 
          where channel_type='SPP'
          and 
           NULLIF(TRIM(reporting_group), '')    is null
           ) select * from tmp",P1,0,5
Reporting_geoup_final_check,Blank_Reporting_group,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20211','dq_20212')",P1,0,6
dq_20311,Blank_prod_desc,com_us_lake,dagg_cdit_redist,prod_nm,"

with  dagg_cdit_redist as 
(select product_name,contract_id,parent_customer from  com_us_lake.dagg_cdit_redist    WHERE  aud_row_stat_ind='0'
--union  select product_name,contract_id,parent_customer FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'
 )
 ,
 tmp as
(select count(prod_nm) 

FROM dagg_cdit_redist  a
 left join 
( SELECT  prod_id,prod_nm
FROM com_us_hub.ref_prd_prod prd
WHERE aud_row_stat_ind='0' group by prod_id,prod_nm) prd
on a.product_name=prd.prod_id 
 left join 
   com_us_lake.udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    com_us_lake.udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   com_us_lake.udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
   
  where COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP'
 AND   NULLIF(TRIM( prd.prod_nm), '')    is null
 )	
 select * from tmp",P1,0,7
dq_20312,Blank_prod_desc,com_us_lake,bpri_salesordertransactions,prod_nm,"with prd  as
(select * from  com_us_hub.ref_prd_prod),
bpri_salesordertransactions as
(
select * from com_us_lake.bpri_salesordertransactions),

udef_na_hierarchy  as ( select sap_cust_number,channel_type  from com_us_lake.udef_na_hierarchy group by sap_cust_number,channel_type ),

tmp as 

(select  prod_nm from (			SELECT 

bpri_customermasterdata.customer Bill_To_Cust_NM    	
,bpri_customermasterdata.customer,
p.prod_nm
FROM com_us_lake.BPRI_OpenOrderExtract BPRI_OpenOrderExtract
INNER JOIN bpri_salesordertransactions
         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_OpenOrderExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_OpenOrderExtract.Sales_doc_Item,""^0+(?!$)"","""") 
             )
INNER JOIN com_us_lake.bpri_customermasterdata  bpri_customermasterdata
on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')
inner JOIN
       prd p
        ON  regexp_replace(BPRI_OpenOrderExtract.MATERIAL,""^0+"","""") = regexp_replace(p.prod_id,""^0+(?!$)"","""")
        
        
        
        WHERE
bpri_salesordertransactions.billtoprty <>'0000336234' 
and (bpri_salesordertransactions.REASON_REJ is null or bpri_salesordertransactions.REASON_REJ = '')
AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
AND (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null or bpri_salesordertransactions.STORNO = '')
AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')
)  a 

left join
         udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM a.customer)   
         where channel_type ='SPP'
       and NULLIF(TRIM( prod_nm), '')  is null
         
         union 
         
         (SELECT 
 
  	 p.prod_nm


FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
   		   INNER JOIN 
com_us_lake.bpri_customermasterdata
   on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')

               inner JOIN
        prd p
        ON(regexp_replace(bpri_materialmasterdata.material,""^0+(?!$)"","""") = regexp_replace(p.prod_id,""^0+(?!$)"","""")) 


  where  
    bpri_salesordertransactions.billtoprty <>'0000336234' 
  AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
  and (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null)
	AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')

and channel_type='SPP'
and NULLIF(TRIM( prod_nm), '')  is null
  ) 
    )
    
    select count(1) from tmp",P1,0,8
prod_desc_final_check,customer_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20311','dq_20312')",P1,0,9
dq_20411,Blank_channel_nm,com_us_lake,dagg_cdit_redist,row_id,"with dagg_cdit_redist as 
(select product_name,contract_id,parent_customer,aud_row_stat_ind from  com_us_lake.dagg_cdit_redist    WHERE  aud_row_stat_ind='0'
--union  select product_name,contract_id,parent_customer,aud_row_stat_ind FROM com_us_lake.cnp_bd_cbk_sls WHERE  aud_row_stat_ind='0'
 ) ,
 
 tmp as (
 select COALESCE(b.channel_name,c.channel_name,d.channel_name) channel_name ,
 COALESCE(b.channel_type,c.channel_type,d.channel_type) channel_type 
  from dagg_cdit_redist a
 left join 
   com_us_lake.udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    com_us_lake.udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   com_us_lake.udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
     
   )
   
   select count(channel_name ) from tmp where  channel_type = 'SPP'  and  NULLIF(TRIM( channel_name), '') is null
   ",P1,0,10
dq_20412,Blank_channel_nm,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp as  (select  channel_type,channel_name from (			SELECT 

bpri_customermasterdata.customer Bill_To_Cust_NM    	
,bpri_customermasterdata.customer

FROM com_us_lake.BPRI_OpenOrderExtract BPRI_OpenOrderExtract
INNER JOIN com_us_lake.bpri_salesordertransactions
         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_OpenOrderExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_OpenOrderExtract.Sales_doc_Item,""^0+(?!$)"","""") 
             )
INNER JOIN com_us_lake.bpri_customermasterdata  bpri_customermasterdata
on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')
inner JOIN
        com_us_hub.ref_prd_prod p
        ON  regexp_replace(BPRI_OpenOrderExtract.MATERIAL,""^0+"","""") = regexp_replace(p.prod_id,""^0+(?!$)"","""")
        
        
        
        WHERE
bpri_salesordertransactions.billtoprty <>'0000336234' 
and (bpri_salesordertransactions.REASON_REJ is null or bpri_salesordertransactions.REASON_REJ = '')
AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
AND (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null or bpri_salesordertransactions.STORNO = '')
AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')
)  a 

left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM a.customer)   
         where channel_type ='SPP'
       and NULLIF(TRIM( channel_name), '')  is null
         
         union 
         
         (SELECT 
 
distinct  channel_type	 ,channel_name


FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN com_us_lake.bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
   		   INNER JOIN 
com_us_lake.bpri_customermasterdata
   on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')


  where  
    bpri_salesordertransactions.billtoprty <>'0000336234' 
  AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
  and (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null)
	AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')

and channel_type='SPP'
and NULLIF(TRIM( channel_name), '')  is null
  ) 
    )
    
    select count(1) from tmp",P1,0,11
channel_nm_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20411','dq_20412')",P1,0,12
dq_20511,Blank_channel_nm,com_us_lake,dagg_cdit_redist,row_id,"with dagg_cdit_redist as 
(select product_name,contract_id,parent_customer,aud_row_stat_ind from  com_us_lake.dagg_cdit_redist    WHERE  aud_row_stat_ind='0'
--union  select product_name,contract_id,parent_customer,aud_row_stat_ind FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'
 ) ,
 
 tmp as (
 select COALESCE(b.channel_name,c.channel_name,d.channel_name) channel_name ,
 COALESCE(b.channel_type,c.channel_type,d.channel_type) channel_type 
  from dagg_cdit_redist a
 left join 
   com_us_lake.udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    com_us_lake.udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   com_us_lake.udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
     
   )
   
   select count(channel_name ) from tmp where  channel_type = 'SPP'  and  NULLIF(TRIM( channel_name), '') is null",P1,0,13
dq_20512,Blank_channel_nm,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp as  (select  channel_type,channel_name from (			SELECT 

bpri_customermasterdata.customer Bill_To_Cust_NM    	
,bpri_customermasterdata.customer

FROM com_us_lake.BPRI_OpenOrderExtract BPRI_OpenOrderExtract
INNER JOIN com_us_lake.bpri_salesordertransactions
         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_OpenOrderExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_OpenOrderExtract.Sales_doc_Item,""^0+(?!$)"","""") 
             )
INNER JOIN com_us_lake.bpri_customermasterdata  bpri_customermasterdata
on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')
inner JOIN
        com_us_hub.ref_prd_prod p
        ON  regexp_replace(BPRI_OpenOrderExtract.MATERIAL,""^0+"","""") = regexp_replace(p.prod_id,""^0+(?!$)"","""")
        
        
        
        WHERE
bpri_salesordertransactions.billtoprty <>'0000336234' 
and (bpri_salesordertransactions.REASON_REJ is null or bpri_salesordertransactions.REASON_REJ = '')
AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
AND (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null or bpri_salesordertransactions.STORNO = '')
AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')
)  a 

left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM a.customer)   
         where channel_type ='SPP'
       and NULLIF(TRIM( channel_name), '')  is null
         
         union 
         
         (SELECT 
 
distinct  channel_type	 ,channel_name


FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN com_us_lake.bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
   		   INNER JOIN 
com_us_lake.bpri_customermasterdata
   on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')


  where  
    bpri_salesordertransactions.billtoprty <>'0000336234' 
  AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
  and (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null)
	AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')

and channel_type='SPP'
and NULLIF(TRIM( channel_name), '')  is null
  ) 
    )
    
    select count(1) from tmp",P1,0,14
channel_nm_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20511','dq_20512')",P1,0,15
dq_20511,Blank_End_Customer,com_us_lake,dagg_cdit_redist,row_id,"with  dagg_cdit_redist as
(select prescriber_id,ship_to_org_id ,source,contract_id, parent_customer  from 
com_us_lake.dagg_cdit_redist a where    aud_row_stat_ind='0'
--union select prescriber_id,ship_to_org_id ,source,contract_id, parent_customer FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'
) ,
--select * from dagg_cdit_redist
ref_cust_profile as 
( select  *  from com_us_hub.ref_cust_profile ),
udef_na_hierarchy as
( select channel_type,flex_cust_number,contract_id from com_us_lake.udef_na_hierarchy  group by channel_type,flex_cust_number,contract_id),
  
--select * from udef_na_hierarchy
tmp as 
(
select     
  
COALESCE(b.channel_type,c.channel_type,d.channel_type) channel_type 

from  dagg_cdit_redist a
 left join 
   udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
  

 left  join 
  
  (select  omni_id  from ref_cust_profile where scd_curr_ind='Y' group by omni_id) cust_profile
   
  on CAST(case when a.source='BD' THEN a.ship_to_org_id ELSE prescriber_id END AS VARCHAR(50))= cust_profile.omni_id 
  
  left join 
  
  (select a.omni_id,a.src_id  from com_us_hub.ref_cust_xref a
left join  com_us_lake.feed_lkp b on upper(a.src_system)=upper(b.src_system) where b.src is not null and b.src='LH' group by  a.omni_id,a.src_id  )  xref

on    CAST(case when a.source='BD' THEN a.ship_to_org_id ELSE prescriber_id END AS VARCHAR(50))= xref.src_id

left join

(select a.omni_id,ltrim('0',a.src_id) as src_id from com_us_hub.ref_cust_xref a
left join  com_us_lake.feed_lkp b on upper(a.src_system)=upper(b.src_system) where b.src is not null  and b.src='LH'  group by a.omni_id,ltrim('0',a.src_id) )  cust_xref
on cust_xref.src_id= CAST(case when a.source='BD' THEN a.ship_to_org_id ELSE prescriber_id END AS VARCHAR(50))

  
join com_us_lake.hem_affiliation_table pr on COALESCE(cust_profile.omni_id ,xref.src_id,cust_xref.src_id ) = pr.Shire_ID_End_Customer

where pr.Name_of_Account_End_Customer is null  and   COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP')
select count(1) from tmp",P1,0,16
dq_20512,Blank_End_Customer,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp as  (select  channel_type,channel_name from (			SELECT 

bpri_customermasterdata.customer Bill_To_Cust_NM    	
,bpri_customermasterdata.customer

FROM com_us_lake.BPRI_OpenOrderExtract BPRI_OpenOrderExtract
INNER JOIN com_us_lake.bpri_salesordertransactions
         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_OpenOrderExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_OpenOrderExtract.Sales_doc_Item,""^0+(?!$)"","""") 
             )
INNER JOIN com_us_lake.bpri_customermasterdata  bpri_customermasterdata
on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')
inner JOIN
        com_us_hub.ref_prd_prod p
        ON  regexp_replace(BPRI_OpenOrderExtract.MATERIAL,""^0+"","""") = regexp_replace(p.prod_id,""^0+(?!$)"","""")
        
        
        
        WHERE
bpri_salesordertransactions.billtoprty <>'0000336234' 
and (bpri_salesordertransactions.REASON_REJ is null or bpri_salesordertransactions.REASON_REJ = '')
AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
AND (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null or bpri_salesordertransactions.STORNO = '')
AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')
)  a 

left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM a.customer)   
         where channel_type ='SPP'
       and NULLIF(TRIM( channel_name), '')  is null
         
         union 
         
         (SELECT 
 
distinct  channel_type	 ,channel_name


FROM com_us_lake.BPRI_BillingExtract BPRI_BillingExtract
INNER JOIN com_us_lake.bpri_salesordertransactions

         ON (
         regexp_replace(bpri_salesordertransactions.doc_number,""^0+(?!$)"","""") = regexp_replace(BPRI_BillingExtract.Sales_document,""^0+(?!$)"","""") 
         AND regexp_replace(bpri_salesordertransactions.s_ord_item,""^0+(?!$)"","""") =  regexp_replace(BPRI_BillingExtract.Sales_doc_Item,""^0+(?!$)"","""")
             )          
          INNER JOIN
com_us_lake.bpri_materialmasterdata
          ON (    
bpri_salesordertransactions.material=bpri_materialmasterdata.material
                     AND bpri_materialmasterdata.logsys in('PRDCLNT100')
		    AND bpri_materialmasterdata.MATL_TYPE in (""FINI"",'TRAD')
            ) 
            left join
         com_us_lake.udef_na_hierarchy   
         on sap_cust_number=trim(LEADING '0' FROM BPRI_BillingExtract.Sold_to_party)   
         
   		   INNER JOIN 
com_us_lake.bpri_customermasterdata
   on bpri_salesordertransactions.sold_to=bpri_customermasterdata.customer
AND bpri_customermasterdata.logsys in('PRDCLNT100')


  where  
    bpri_salesordertransactions.billtoprty <>'0000336234' 
  AND bpri_salesordertransactions.doc_type IN ('ZXOA','ZXDR','ZXCR','ZXOE','ZXOR')
  and (bpri_salesordertransactions.STORNO  <> 'R' or bpri_salesordertransactions.STORNO is null)
	AND bpri_salesordertransactions.comp_code  in ('3390','3311','3312')

and channel_type='SPP'
and NULLIF(TRIM( channel_name), '')  is null
  ) 
    )
    
    select count(1) from tmp",P1,0,17
End_Customer_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_20511','dq_20512')",P1,0,18
