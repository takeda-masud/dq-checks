dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_20111,Blank_prod_id,com_us_lake,dagg_cdit_redist,row_id,"with dagg_cdit_redist as 
(select product_name,contract_id,parent_customer,aud_row_stat_ind from  com_us_lake.dagg_cdit_redist    WHERE  aud_row_stat_ind='0'
--union  select product_name,contract_id,parent_customer,aud_row_stat_ind FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'
 ) select count(*) FROM dagg_cdit_redist  a
 left join 
( SELECT  prod_id
FROM com_us_hub.ref_prd_prod prd
WHERE aud_row_stat_ind='0' group by prod_id) prd
on a.product_name=prd.prod_id 
 left join 
   com_us_lake.udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    com_us_lake.udef_na_hierarchy c on 
   a.contract_id=c.contract_id
    left join 
   com_us_lake.udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
     where COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP'
  and prd.prod_id is null	",P1,0,1
dq_20211,Blank_Reporting_group,com_us_lake,dagg_cdit_redist,row_id,"with  dagg_cdit_redist as
(select contract_id, parent_customer,ndc_code  from 
com_us_lake.dagg_cdit_redist a where    aud_row_stat_ind='0'  and to_date(gl_date,'yyyy-MM-dd')>to_Date(add_months(current_date , -48),'MM/DD/YYYY') 
union 
select contract_id, parent_customer,ndc_code FROM com_us_lake.cnp_bd_cbk_sls  WHERE  aud_row_stat_ind='0'  and to_date(gl_date,'yyyy-MM-dd')>to_Date(add_months(current_date , -48),'MM/DD/YYYY')
) ,
udef_na_hierarchy as
( select channel_type,flex_cust_number,contract_id from com_us_lake.udef_na_hierarchy  group by channel_type,flex_cust_number,contract_id)
  

select     
  
count(ndc_code) 

from  dagg_cdit_redist a
 left join 
   udef_na_hierarchy   b    on a.parent_customer=b.flex_cust_number
   left join
    udef_na_hierarchy c on 
   a.contract_id=c.contract_id
  
  left join 
   udef_na_hierarchy d on 
   a.contract_id=substr(d.contract_id,2,5) 
  where  COALESCE(b.channel_type,c.channel_type,d.channel_type) ='SPP'  
 and   NULLIF(TRIM(ndc_code), '')    is null",P1,0,3
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","with latest as ( select metric,threshold,entity_id,row_number() over (partition by entity_id order by  insertdate desc) as rank from dq_output_table) Select case when metric > threshold then 1 else 0 end as res from latest where entity_id in ('dq_20111','dq_20112') and rank=1",P1,0,15
