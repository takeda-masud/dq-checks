dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_1011,project_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_comp cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where cmp.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1011) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1011)   and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1011) prv on cur.product=prv.product) select * from tmp",P1,10,101
dq_1012,project_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_dispense_file cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where cmp.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1012) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1012)   and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1012) prv on cur.product=prv.product) select * from tmp",P1,10,102
product_final_check,project_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1011','dq_1012')",P1,0,103
dq_1211,channel_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(1) as cur_cnt, channel_name from (select order_transaction_number, pa.ship_date, level_1_sales_force, contract_id from (select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where sub.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1211) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1211)   and upper(level_1_sales_force) = 'HEMATOLOGY' group by channel_name) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1211) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,104
dq_1212,channel_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(1) as cur_cnt, channel_name from (select order_transaction_number, pa.ship_date, level_1_sales_force, contract_id from (select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where sub.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1212) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1212) and upper(level_1_sales_force) = 'HEMATOLOGY' group by channel_name) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1212) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,105
channel_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1211','dq_1212')",P1,0,106
dq_1611,project_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(distinct LH_PATIENT_ID) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_comp cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where cmp.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1611) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1611)   and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1611) prv on cur.product=prv.product) select * from tmp",P1,10,107
dq_1612,project_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(distinct LH_PAT_ID) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_dispense_file cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where cmp.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1612) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1612)  and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1612) prv on cur.product=prv.product) select * from tmp",P1,10,108
pr_patient_final_check,project_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1611','dq_1612')",P1,0,109
dq_1811,channel_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(distinct LH_PATIENT_ID) as cur_cnt, channel_name from (select lh_transaction_id, pa.ship_date, level_1_sales_force, contract_id, LH_PATIENT_ID from (select lh_transaction_id, pharmacy_name, level_1_sales_force, LH_PATIENT_ID, cmp.ship_date from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select lh_transaction_id, pharmacy_name, level_1_sales_force, LH_PATIENT_ID, cmp.aud_upd_dts from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where sub.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1811) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1811)  and upper(level_1_sales_force) = 'HEMATOLOGY' group by channel_name) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1811) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,110
dq_1812,channel_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select max(cur_cnt/metric*100) as metric from (select count(distinct LH_PAT_ID) as cur_cnt, channel_name from (select order_transaction_number, pa.ship_date, level_1_sales_force, contract_id, LH_PAT_ID from (select order_transaction_number, pharmacy_name, level_1_sales_force, LH_PAT_ID, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select order_transaction_number, pharmacy_name, level_1_sales_force, LH_PAT_ID, cmp.aud_upd_dts from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where  sub.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table
where rule_key = 1812) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1812)  and upper(level_1_sales_force) = 'HEMATOLOGY' group by channel_name) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1812) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,10,111
ch_patient_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1811','dq_1812')",P1,0,112
