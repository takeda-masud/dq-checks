dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_2421,product_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_redist_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur inner join (select metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 2421) prv on cur.product=prv.product) select * from tmp",P1,20,101
dq_2422,product_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_dir_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur inner join (select metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 2422) prv on cur.product=prv.product) select * from tmp",P1,20,102
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2421','dq_2422')",P1,0,103
dq_2621,channel_name_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_redist_sls sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key =2621) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,104
dq_2622,channel_name_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_dir_sls sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 2622) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,105
channel_name_final_check,channel_name_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2621','dq_2622')",P1,0,106
dq_2721,channel_type_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, chnl_typ as channel_type from com_us_hub.txn_redist_sls sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by chnl_typ) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as  channel_type from com_us_lake.dq_count_table where rule_key = 2721) prv on cur. channel_type=prv. channel_type) select * from tmp",P1,20,107
dq_2722,channel_type_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, chnl_typ as channel_type from com_us_hub.txn_dir_sls sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by chnl_typ) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as  channel_type from com_us_lake.dq_count_table where rule_key = 2722) prv on cur. channel_type=prv. channel_type) select * from tmp",P1,20,108
channel_type_final_check,channel_type_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_imm_2721','dq_imm_2722')",P1,0,109
dq_2921,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 2921) prv on cur.region = prv.region) select * from tmp",P1,20,110
dq_2922,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where  rule_key = 2922) prv on cur.region = prv.region) select * from tmp",P1,20,111
dq_2923,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where  rule_key = 2923) prv on cur.region = prv.region) select * from tmp",P1,20,112
dq_2924,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where  rule_key = 2924) prv on cur.region = prv.region) select * from tmp",P1,20,113
region_final_check,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2921','dq_2922','dq_2923','dq_2924')",P1,0,114
dq_3021,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3021) prv on cur.territory = prv.territory) select * from tmp",P1,20,115
dq_3022,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3022) prv on cur.territory = prv.territory) select * from tmp",P1,20,116
dq_3023,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3023) prv on cur.territory = prv.territory) select * from tmp",P1,20,117
dq_3024,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.gl_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3024) prv on cur.territory = prv.territory) select * from tmp",P1,20,118
territory_final_check,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3021','dq_3022','dq_3023','dq_3024')",P1,0,119
