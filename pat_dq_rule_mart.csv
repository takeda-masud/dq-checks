dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_931,unit_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 931) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 931) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 931) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,1
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_931'),P1,0,2
dq_1031,product_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt,  brand_nm as product from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1031)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1031) and upper(franchise_nm)='HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1031) prv on cur.product = prv.product) select * from tmp",P1,10,3
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1031'),P1,0,4
dq_1231,channel_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1231) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1231) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1231) prv on cur.channel_name = prv.channel_name) select * from tmp",P1,10,5
channel_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1231'),P1,0,6
dq_1331,region_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, region from
(select patient_dispense_key,ship_date,reg_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0
union
select patient_dispense_key,ship_date,reg_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1331) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1331) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1331) prv on cur.region = prv.region) select * from tmp",P1,10,7
region_final_count,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1331'),P1,0,8
dq_1431,territory_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, territory from
(select patient_dispense_key,ship_date,terr_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0
union
select patient_dispense_key,ship_date,reg_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1431) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1431) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 1431) prv on cur.territory = prv.territory) select * from tmp",P1,10,9
territory_final_count,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1431'),P1,0,10
dq_1531,patient_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, 'Unit' as field_name from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1531) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1531) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 1531) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,11
patient_final_check,patient_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1531'),P1,0,12
dq_1631,product_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt,  brand_nm as product from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1631)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1631) and upper(franchise_nm)='HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1631) prv on cur.product = prv.product) select * from tmp",P1,10,13
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1631'),P1,0,14
dq_1831,channel_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, chnl_nm as channel_name from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1831) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1831) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1831) prv on cur.channel_name = prv.channel_name) select * from tmp",P1,10,15
channel_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1831'),P1,0,16
dq_1931,region_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, region from
(select patient_dispense_key,ship_date,dagg_patient_id,reg_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,reg_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as region from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1931) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1931) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1931) prv on cur.region = prv.region) select * from tmp",P1,10,17
region_final_count,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1931'),P1,0,18
dq_2031,territory_count,com_us_mart_03,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, territory from
(select patient_dispense_key,ship_date,dagg_patient_id,terr_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,reg_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as territory from com_us_mart_03.txn_patient_dispense pa join com_us_mart_03.ref_prod_market_def mk on upper(pa.prod_key) = upper(mk.prod_key) join com_us_mart_03.txn_terr_assign on patient_dispense_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 2031) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 2031) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 2031) prv on cur.territory = prv.territory) select * from tmp",P1,10,19
territory_final_count,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2031'),P1,0,20
