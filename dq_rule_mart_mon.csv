dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_2331,unit_count,com_us_mart_03,txn_dir_redist_sls,dir_redist_sls_key,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_mart_03.txn_dir_redist_sls sa where sa.gl_date between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' ) cur cross join (select metric, field_name from com_us_lake.dq_count_table where rule_key = 2331) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,1
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2331'),P1,0,2
dq_2431,product_count,com_us_mart_03,ref_prd_prod,prd_prod_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_mart_03.txn_dir_redist_sls sa join com_us_mart_03.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.gl_date between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select metric, sub_field_name
 as product from com_us_lake.dq_count_table where rule_key = 2431) prv on cur.product=prv.product) select * from tmp",P1,10,3
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2431'),P1,0,4
dq_2831,customer_check,com_us_mart_03,ref_prd_prod,prd_prod_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from ((select count(1) as cur_cnt,pr.End_cust_nm as end_customer from com_us_mart_03.txn_dir_redist_sls sa join com_us_mart_03.ref_affiliated_account pr on sa.end_cust_mstr_id = pr.end_cust_id where sa.gl_date between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.End_cust_nm) cur cross join (select prv_count as prv_cnt,metric, sub_field_name as end_customer from com_us_lake.dq_count_table where rule_key = 2831) prv on cur.end_customer=prv.end_customer)) select * from tmp",P1,10,5
customer_final_check,customer_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2831'),P1,0,6
dq_2931,region_count,com_us_mart_03,txn_terr_assign,terr_assign_key,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select dir_redist_sls_key,gl_date,reg_desc as region from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0 union select dir_redist_sls_key,gl_date,reg_desc as region from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0 union select dir_redist_sls_key,gl_date,area_desc as region from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 2931) prv on cur.region = prv.region) select * from tmp",P1,10,7
region_final_check,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2931'),P1,0,8
dq_3031,territory_count,com_us_mart_03,txn_terr_assign,terr_assign_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from
(select dir_redist_sls_key,gl_date,terr_desc as territory from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = terr_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(terr_assignment)>0 union select dir_redist_sls_key,gl_date,reg_desc as territory from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = reg_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(reg_assignment)>0 union select dir_redist_sls_key,gl_date,area_desc as territory from com_us_mart_03.txn_dir_redist_sls rid join com_us_mart_03.txn_terr_assign on dir_redist_sls_key = transaction_row_key join com_us_mart_03.ref_sales_hierarchy on terr_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(sa.franchise_nm)='HEMATOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3031) prv on cur.territory = prv.territory) select * from tmp",P1,10,9
territory_final_check,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3031'),P1,0,10
