dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq,
dq_3111,unit_count,com_us_lake,dagg_bax_comp,id,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from (select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3111) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,1,
dq_3112,unit_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from (select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3112) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,2,
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3111',dq_3112')",P1,0,3
dq_3211,product_count,com_us_lake,dagg_bax_comp,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_comp cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3211) prv on cur.product=prv.product) select * from tmp",P1,20,4,
dq_3212,product_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_dispense_file cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3212) prv on cur.product=prv.product) select * from tmp",P1,20,5,
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3211','dq_3212')",P1,0,6
dq_3411,channel_count,com_us_lake,dagg_bax_comp,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, channel_name from ((select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3411) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,7,
dq_3412,channel_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(1) as cur_cnt, channel_name from ((select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3412) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,8,
channel_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3411','dq_3412')",P1,0,9
dq_3711,patient_count,com_us_lake,dagg_bax_comp,id,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(distinct LH_PATIENT_ID) as cur_cnt, 'LH_Patient' as field_name from (select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3711) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,10,
dq_3712,patient_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(distinct LH_PAT_ID) as cur_cnt, 'LH_Patient' as field_name from (select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3712) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,11,
patient_final_check,patient_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3711','dq_3712')",P1,0,12
dq_3811,product_count,com_us_lake,dagg_bax_comp,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(distinct LH_PATIENT_ID) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_comp cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3811) prv on cur.product=prv.product) select * from tmp",P1,20,13,
dq_3812,product_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(distinct LH_PAT_ID) as cur_cnt, brand_nm as product from com_us_lake.dagg_bax_dispense_file cmp join (select src.row_key,src.brand_nm,franchise_nm,src.prod_ndc_id from (SELECT prd_prod_key as row_key,brand_nm,franchise_nm,prod_ndc_id,row_number() over(partition by prod_ndc_id order by prod_id desc) as rn FROM COM_US_HUB.ref_prd_prod WHERE aud_row_stat_ind='0') src where rn=1) pr on cmp.ndc_number = pr.prod_ndc_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3812) prv on cur.product=prv.product) select * from tmp",P1,20,14,
project_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_3811','dq_3812')",P1,0,15
dq_4011,channel_count,com_us_lake,dagg_bax_comp,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(distinct LH_PATIENT_ID) as cur_cnt, channel_name from ((select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 4011) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,16,
dq_4012,channel_count,com_us_lake,dagg_bax_dispense_file,id,"with tmp (select max(abs((cur_cnt-metric)/metric*100)) as metric from (select count(distinct LH_PAT_ID) as cur_cnt, channel_name from ((select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select * from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa join com_us_lake.contract_xwalk wk on pa.pharmacy_name = wk.lh_pharmacy_name) sub left join com_us_lake.udef_na_hierarchy hrc on sub.contract_id = hrc.contract_id where to_date(ship_date,'yyyyMMdd') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 4012) prv on cur.channel_name=prv.channel_name) select * from tmp",P1,20,17,
channel_final_count,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_4011','dq_4012')",P1,0,18
