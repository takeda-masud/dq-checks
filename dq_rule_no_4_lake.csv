dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
101,product_count,com_us_lake,dagg_cdit_redist,row_id,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, pr.channel_name as product from com_us_lake.dagg_cdit_redist sa join (select   d.channel_name,a.lh_pat_id
 from 
com_us_lake.dagg_bax_dispense_file a
--WHERE aud_row_status_ind='0')
left join 
(select distinct lh_pharmacy_name,contract_id from com_us_lake.contract_xwalk) b on a.pharmacy_name=b.lh_pharmacy_name
left join 

(select distinct  udef_na_hierarchy.channel_name as channel_name, udef_na_hierarchy.contract_id as contract_id from com_us_lake.udef_na_hierarchy) d
on b.contract_id=d.contract_id) pr on    sa.patient_id=pr.lh_pat_id  join com_us_lake.man_lov lv on sa.product_name = lv.lov_code where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'dagg_cdit_redist-udef_na_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'dagg_cdit_redist-udef_na_hierarchy') and upper(LOV_DESCRIPTION)='HEMATOLOGY' group by pr.channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'dagg_cdit_redist-udef_na_hierarchy') prv on cur.product=prv.product)) select * from tmp",P1,10,1
102,product_count,com_us_lake,udef_ic_order_adjustments,id,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, pr.channel_name as product from com_us_lake.udef_ic_order_adjustments sa join  (select   d.channel_name,prod_id
 from 
com_us_lake.dagg_bax_dispense_file a
--WHERE aud_row_status_ind='0')
left join 
(select distinct lh_pharmacy_name,contract_id from com_us_lake.contract_xwalk) b on a.pharmacy_name=b.lh_pharmacy_name
left join 

(select distinct  udef_na_hierarchy.channel_name as channel_name, udef_na_hierarchy.contract_id as contract_id from com_us_lake.udef_na_hierarchy) d
on b.contract_id=d.contract_id

left join 
 com_us_hub.ref_prd_prod  p
 on a.ndc_number=p.prod_ndc_id )pr 
on sa.product = pr.prod_id join com_us_lake.man_lov lv on sa.product = lv.lov_code where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_4' and table_name = 'udef_ic_order_adjustments-udef_na_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_4' and table_name = 'udef_ic_order_adjustments-ref_prd_prod') and upper(LOV_DESCRIPTION)='HEMATOLOGY' group by pr.channel_name) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where dq_rule = 'dq_rule_4' and table_name = 'udef_ic_order_adjustments-udef_na_hierarchy') prv on cur.product=prv.product)) select * from tmp

",P1,10,2
103,product_count,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, p.brand_nm as product from com_us_lake.BPRI_BillingExtract bill JOIN com_us_lake.bpri_salesordertransactions sal ON (regexp_replace(sal.doc_number, ""^0+(?!$)"", """") = regexp_replace(bill.Sales_document, ""^0+(?!$)"", """") AND regexp_replace(sal.s_ord_item, ""^0+(?!$)"", """") = regexp_replace(bill.Sales_doc_Item, ""^0+(?!$)"", """")) INNER JOIN com_us_lake.bpri_materialmasterdata mat ON (sal.material=mat.material) inner JOIN com_us_hub.ref_prd_prod p ON(regexp_replace(mat.material, ""^0+(?!$)"", """") = regexp_replace(p.prod_id, ""^0+(?!$)"", """")) join com_us_lake.man_lov lv on regexp_replace(mat.material, ""^0+(?!$)"", """") = lv.lov_code where to_date(bill.Billing_doc__date, 'MM/dd/yy') between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'bpri_salesordertransactions-ref_prd_prod') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'bpri_salesordertransactions-ref_prd_prod') and upper(LOV_DESCRIPTION)='HEMATOLOGY' group by p.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where dq_rule = 'dq_rule_2' and table_name = 'bpri_salesordertransactions-ref_prd_prod') prv on cur.product=prv.product)) select * from tmp",P1,10,3
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","Select case when metric > threshold then 1 else 0 end as res from dq_output_table where entity_id in (101,102,103)",P1,0,4
