dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_921,unit_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date  between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 921) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 921) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 921) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,101
dq_1521,patient_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select sum(count) as cur_cnt,field_name from (select count(distinct dagg_patient_id) as count, 'LH_Patient' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1521) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1521) and upper(franchise_nm) = 'HEMATOLOGY' group by extract(month from pa.ship_date), extract(year from pa.ship_date)) group by field_name) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 1521) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,102
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when round(metric,2) > threshold then 1 else 0 end as res from dq_output_table where entity_id in ('dq_921','dq_1521')",P1,0,103
