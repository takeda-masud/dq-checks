dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_3221,product_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3221) prv on cur.product =prv.product) select * from tmp",P1,20,101
dq_3421,channel_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 3421) prv on cur.channel_name =prv.channel_name) select * from tmp",P1,20,102
dq_3521,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, region from (select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 3521) prv on cur.region = prv.region) select * from tmp",P1,20,103
dq_3522,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, region from (select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 3522) prv on cur.region = prv.region) select * from tmp",P1,20,104
dq_3621,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select patient_dispense_key,ship_date,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3621) prv on cur.territory = prv.territory) select * from tmp",P1,20,105
dq_3622,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(1) as cur_cnt, territory from (select patient_dispense_key,ship_date,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 3622) prv on cur.territory = prv.territory) select * from tmp",P1,20,106
dq_3821,product_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, brand_nm as product from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 3821) prv on cur.product =prv.product) select * from tmp",P1,20,107
dq_4021,channel_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 4021) prv on cur.channel_name =prv.channel_name) select * from tmp",P1,20,108
dq_4121,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, region from(select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key, ship_date,dagg_patient_id,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 4121) prv on cur.region = prv.region) select * from tmp",P1,20,109
dq_4122,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, region from (select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by region) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 4122) prv on cur.region = prv.region) select * from tmp",P1,20,110
dq_4221,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, territory from (select patient_dispense_key,ship_date,dagg_patient_id,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 4221) prv on cur.territory = prv.territory) select * from tmp",P1,20,111
dq_4222,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs(((cur_cnt-metric)/metric)*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, territory from (select patient_dispense_key,ship_date,dagg_patient_id,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select patient_dispense_key,ship_date,dagg_patient_id,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_dispen_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where pa.ship_date between trunc(add_months(current_date, -1), 'mm') and date_add(trunc((current_date), 'mm'), -1) group by territory) cur inner join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 4222) prv on cur.territory = prv.territory) select * from tmp",P1,20,112
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from dq_output_table where entity_id in ('dq_3221','dq_3421','dq_3521','dq_3522','dq_3621','dq_3622','dq_3821','dq_4021','dq_4121','dq_4122','dq_4221','dq_4222')",P1,0,113
