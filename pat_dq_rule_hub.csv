dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_921,unit_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 921)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 921) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 921) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,1
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_921'),P1,0,2
dq_1021,product_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, brand_nm as product from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1021)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1021) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1021) prv on cur.product =prv.product) select * from tmp",P1,10,3
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1021'),P1,0,4
dq_1221,channel_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1021)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1021) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1021) prv on cur.channel_name =prv.channel_name) select * from tmp",P1,10,5
channel_final_check,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1221'),P1,0,6
dq_1321,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from
(select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1321) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1321) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1321) prv on cur.region = prv.region) select * from tmp",P1,10,7
dq_1322,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from
(select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1322) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1322) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1322) prv on cur.region = prv.region) select * from tmp",P1,10,8
region_final_check,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1321','dq_1322')",P1,0,9
dq_1421,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from
(select patient_dispense_key,ship_date,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1421) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1421) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 1421) prv on cur.territory = prv.territory) select * from tmp",P1,10,10
dq_1422,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from
(select patient_dispense_key,ship_date,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1422) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1422) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 1422) prv on cur.territory = prv.territory) select * from tmp",P1,10,11
territory_final_check,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1421','dq_1422')",P1,0,12
dq_1521,patient_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, 'LH_Patient' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1521)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1521) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 1521) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,13
patient_final_check,patient_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1521'),P1,0,14
dq_1621,product_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, brand_nm as product from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_prod prd on upper(pa.prod_key) = upper(prd.prd_prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1621)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1621) and upper(franchise_nm) = 'HEMATOLOGY' group by brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 1621) prv on cur.product =prv.product) select * from tmp",P1,10,15
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1621'),P1,0,16
dq_1821,channel_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, chnl_nm as channel_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1821)  and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1821) and upper(franchise_nm) = 'HEMATOLOGY' group by chnl_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as channel_name from com_us_lake.dq_count_table where rule_key = 1821) prv on cur.channel_name =prv.channel_name) select * from tmp",P1,10,17
channel_final_check,channel_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM",select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1821'),P1,0,18
dq_1921,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, region from
(select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1921) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1921) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1921) prv on cur.region = prv.region) select * from tmp",P1,10,19
dq_1922,region_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, region from
(select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,region_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as region from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1922) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1922) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 1922) prv on cur.region = prv.region) select * from tmp",P1,10,20
region_final_check,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_1921','dq_1922')",P1,0,21
dq_2021,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, territory from
(select patient_dispense_key,ship_date,dagg_patient_id,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_prev_qtr_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 2021) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 2021) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 2021) prv on cur.territory = prv.territory) select * from tmp",P1,10,22
dq_2022,territory_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(distinct dagg_patient_id) as cur_cnt, territory from
(select patient_dispense_key,ship_date,dagg_patient_id,territory_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,region_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0
union
select patient_dispense_key,ship_date,dagg_patient_id,area_desc as territory from com_us_hub.txn_patient_dispense pat join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on patient_dispense_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment join com_us_hub.ref_prd_mkt_def mk on upper(pat.prod_key) = upper(mk.prod_key) where mk.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where to_date(sa.ship_date,'M/d/y') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 2022) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 2022) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 2022) prv on cur.territory = prv.territory) select * from tmp",P1,10,23
territory_final_check,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_2021','dq_2022')",P1,0,24
