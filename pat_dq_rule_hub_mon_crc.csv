dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_3121,unit_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3121) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,101
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select res from (select case when metric > threshold then 1 else 0 end as res,dense_rank() over(partition by  entity_id    order by timestamp(insertdate)) r,timestamp(insertdate)   from corp_us_lake.dq_output_table   where entity_id in ('dq_3121') and to_date(insertdate,'dd/MM/yyyy')=(select max(to_date(insertdate,'dd/MM/yyyy')) from corp_us_lake.dq_output_table where entity_id in ('dq_3121')))    where r=1",P1,0,102
dq_3721,patient_count,com_us_hub,txn_patient_dispense,patient_dispense_key,"with tmp (select abs((cur_cnt-metric)/metric*100) as metric from (select count(distinct dagg_patient_id) as cur_cnt, 'LH_Patient' as field_name from com_us_hub.txn_patient_dispense pa join com_us_hub.ref_prd_mkt_def mk on upper(pa.prod_key) = upper(mk.prod_key) where to_date(pa.ship_date,'M/d/y') between trunc(current_date, 'mm') and date_add(trunc(add_months(current_date, 1), 'mm'), -1) and upper(franchise_nm) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 3721) prv on cur.field_name=prv.field_name) select * from tmp",P1,20,103
patient_final_check,patient_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select res from (select case when metric > threshold then 1 else 0 end as res,dense_rank() over(partition by  entity_id    order by timestamp(insertdate)) r,timestamp(insertdate)   from corp_us_lake.dq_output_table   where entity_id in ('dq_3721') and to_date(insertdate,'dd/MM/yyyy')=(select max(to_date(insertdate,'dd/MM/yyyy')) from corp_us_lake.dq_output_table where entity_id in ('dq_3721')))    where r=1",P1,0,104
