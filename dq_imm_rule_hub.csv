dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_imm_221,product_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_redist_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) and upper(sa.franchise_nm)='IMMUNOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 100221) prv on cur.product=prv.product) select * from tmp",P1,10,101
dq_imm_222,product_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_dir_sls sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) and upper(sa.franchise_nm)='IMMUNOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 100222) prv on cur.product=prv.product) select * from tmp",P1,10,102
dq_imm_223,product_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, pr.brand_nm as product from com_us_hub.txn_udef_order_adjs sa join com_us_hub.ref_prd_prod pr on sa.prod_key = pr.prd_prod_key where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) and upper(sa.franchise_nm)='IMMUNOLOGY' group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 100223) prv on cur.product=prv.product) select * from tmp",P1,10,103
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_imm_221','dq_imm_222','dq_imm_223')",P1,0,104
dq_imm_721,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100721) prv on cur.region = prv.region) select * from tmp",P1,10,105
dq_imm_722,region_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100722) prv on cur.region = prv.region) select * from tmp",P1,10,106
dq_imm_723,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100723) prv on cur.region = prv.region) select * from tmp",P1,10,107
dq_imm_724,region_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc, rid.aud_upd_dts as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100724) prv on cur.region = prv.region) select * from tmp",P1,10,108
dq_imm_725,region_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select udef_order_adjs_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100725) prv on cur.region = prv.region) select * from tmp",P1,10,109
dq_imm_726,region_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select udef_order_adjs_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as region, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where rule_key = 100726) prv on cur.region = prv.region) select * from tmp",P1,10,110
region_final_check,region_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_imm_721','dq_imm_722','dq_imm_723','dq_imm_724','dq_imm_725','dq_imm_726')",P1,0,111
dq_imm_821,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100821) prv on cur.territory = prv.territory) select * from tmp",P1,10,112
dq_imm_822,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select redist_sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100822) prv on cur.territory = prv.territory) select * from tmp",P1,10,113
dq_imm_823,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100823) prv on cur.territory = prv.territory) select * from tmp",P1,10,114
dq_imm_824,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select sls_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100824) prv on cur.territory = prv.territory) select * from tmp",P1,10,115
dq_imm_825,territory_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select udef_order_adjs_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100825) prv on cur.territory = prv.territory) select * from tmp",P1,10,116
dq_imm_826,territory_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, territory from (select udef_order_adjs_key,gl_date,territory_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as territory, rid.aud_upd_dts from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'IMMUNOLOGY' and length(area_assignment)>0) sa where sa.aud_upd_dts >= date_add(date_trunc('DD',current_date),-1) group by territory) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as territory from com_us_lake.dq_count_table where rule_key = 100826) prv on cur.territory = prv.territory) select * from tmp",P1,10,117
territory_final_check,territory_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_imm_821','dq_imm_822','dq_imm_823','dq_imm_824','dq_imm_825','dq_imm_826')",P1,0,118
