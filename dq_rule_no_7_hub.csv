dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
201,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_prev_qtr_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy')  and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,1
202,territory_count,com_us_hub,txn_redist_sls,redist_sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select redist_sls_key,gl_date,region_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select redist_sls_key,gl_date,area_desc as region from com_us_hub.txn_redist_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on redist_sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy')  and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_redist_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,2
203,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_prev_qtr_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_prev_qtr_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,3
204,territory_count,com_us_hub,txn_dir_sls,sls_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select sls_key,gl_date,region_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select sls_key,gl_date,area_desc as region from com_us_hub.txn_dir_sls rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on sls_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_dir_sls-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,4
205,territory_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select udef_order_adjs_key,gl_date,region_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_prev_qtr_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_prev_qtr_terr_assign-ref_sales_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_prev_qtr_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_prev_qtr_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,5
206,territory_count,com_us_hub,txn_udef_order_adjs,udef_order_adjs_key,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from (select count(1) as cur_cnt, region from (select udef_order_adjs_key,gl_date,region_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = territory_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(territory_assignment)>0 union select udef_order_adjs_key,gl_date,region_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = region_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(region_assignment)>0 union select udef_order_adjs_key,gl_date,area_desc as region from com_us_hub.txn_udef_order_adjs rid join com_us_hub.txn_curr_qtr_incremntl_redist_terr_assign on udef_order_adjs_key = transaction_row_key join com_us_hub.ref_sales_hierarchy on territory_id = area_assignment where rid.franchise_nm = 'HEMATOLOGY' and length(area_assignment)>0) sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') and (select max(period_end_date) from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') group by region) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as region from com_us_lake.dq_count_table where dq_rule = 'dq_rule_7' and table_name = 'txn_udef_order_adjs-txn_curr_qtr_incremntl_redist_terr_assign-ref_sales_hierarchy') prv on cur.region = prv.region) select * from tmp",P1,10,6
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","Select case when metric > threshold then 1 else 0 end as res from dq_output_table where entity_id in (201,202,203,204,205,206)",P1,0,7
