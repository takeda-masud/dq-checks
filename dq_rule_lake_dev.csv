dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_111,unit_count,com_us_lake,dagg_cdit_redist,row_id,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_lake.dagg_cdit_redist sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 111) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 111) ) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 111) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,1
dq_113,unit_count,com_us_lake,udef_ic_order_adjustments,id,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from com_us_lake.udef_ic_order_adjustments sa where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 113) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 113)) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 113) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,2
dq_114,unit_count,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp (select abs((cur_cnt-prv_cnt)/metric*100) as metric from (select count(1) as cur_cnt,  'Unit' as field_name from com_us_lake.BPRI_BillingExtract bill JOIN com_us_lake.bpri_salesordertransactions sal ON (regexp_replace(sal.doc_number, '^0+(?!$)', '') = regexp_replace(bill.Sales_document,'^0+(?!$)', '') AND regexp_replace(sal.s_ord_item, '^0+(?!$)', '') = regexp_replace(bill.Sales_doc_Item, '^0+(?!$)','')) INNER JOIN com_us_lake.bpri_materialmasterdata mat ON (sal.material=mat.material)  where to_date(bill.Billing_doc__date, 'MM/dd/yy') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 114) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 114)) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 114) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,3
unit_final_check,unit_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_111','dq_113','dq_114')",P1,0,4
dq_211,product_count,com_us_lake,dagg_cdit_redist,row_id,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, pr.brand_nm as product from com_us_lake.dagg_cdit_redist sa join com_us_hub.ref_prd_prod pr on sa.product_name = substring_index(pr.prod_id, '_', -1) where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 211) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 211) group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 211) prv on cur.product=prv.product)) select * from tmp",P1,10,5
dq_213,product_count,com_us_lake,udef_ic_order_adjustments,id,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, pr.brand_nm as product from com_us_lake.udef_ic_order_adjustments sa join com_us_hub.ref_prd_prod pr on sa.product = substring_index(pr.prod_id, '_', -1) where sa.gl_date between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 213) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 213) group by pr.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 213) prv on cur.product=prv.product)) select * from tmp",P1,10,6
dq_214,product_count,com_us_lake,bpri_salesordertransactions,doc_number,"with tmp (select max(abs((cur_cnt-prv_cnt)/metric*100)) as metric from ((select count(1) as cur_cnt, p.brand_nm as product from com_us_lake.BPRI_BillingExtract bill JOIN com_us_lake.bpri_salesordertransactions sal ON (regexp_replace(sal.doc_number, '^0+(?!$)', '') = regexp_replace(bill.Sales_document, '^0+(?!$)', '') AND regexp_replace(sal.s_ord_item, '^0+(?!$)', '') = regexp_replace(bill.Sales_doc_Item, '^0+(?!$)', '')) INNER JOIN com_us_lake.bpri_materialmasterdata mat ON (sal.material=mat.material) inner JOIN com_us_hub.ref_prd_prod p ON(regexp_replace(mat.material, '^0+(?!$)', '') = regexp_replace(p.prod_id, '^0+(?!$)', '')) where to_date(bill.Billing_doc__date, 'MM/dd/yy') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 214) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 214) group by p.brand_nm) cur cross join (select prv_count as prv_cnt, metric, sub_field_name as product from com_us_lake.dq_count_table where rule_key = 214) prv on cur.product=prv.product)) select * from tmp",P1,10,7
product_final_check,product_count,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when metric > threshold then 1 else 0 end as res from corp_us_lake.dq_output_table where entity_id in ('dq_211','dq_213','dq_214')",P1,0,8
