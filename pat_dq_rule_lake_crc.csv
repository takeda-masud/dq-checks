dq_check_id,Check,Database_name,table_name,primary_key_cols,sql_fr_run,priority,threshold,run_seq
dq_911,unit_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from (select lh_transaction_id, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select lh_transaction_id, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(pa.ship_date,'yyyyMMdd') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 911) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 911) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 911) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,101
dq_912,unit_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select count(1) as cur_cnt, 'Unit' as field_name from (select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.NPI_NUMBER = ndc.ndc_code_10digit union select order_transaction_number, pharmacy_name, level_1_sales_force, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.NPI_NUMBER = ndc.ndc_code_11digit) pa where to_date(pa.ship_date,'yyyyMMdd') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 912) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 912) and upper(level_1_sales_force) = 'HEMATOLOGY') cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 912) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,102
dq_1511,patient_count,com_us_lake,dagg_bax_comp,lh_transaction_id,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select sum(cur_cnt) as cur_cnt,field_name from (select count(distinct LH_PATIENT_ID) as cur_cnt, 'Unit' as field_name from (select lh_transaction_id, pharmacy_name, level_1_sales_force, LH_PATIENT_ID, cmp.ship_date from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_10digit union select lh_transaction_id, pharmacy_name, level_1_sales_force, LH_PATIENT_ID, cmp.ship_date from com_us_lake.dagg_bax_comp cmp join com_us_lake.udef_ndc_hier ndc on cmp.ndc_number = ndc.ndc_code_11digit) pa where to_date(pa.ship_date,'yyyyMMdd') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1511) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1511) and upper(level_1_sales_force) = 'HEMATOLOGY' group by extract(month from to_date(pa.ship_date,'yyyyMMdd')), extract(year from to_date(pa.ship_date,'yyyyMMdd'))) group by field_name) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 1511) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,103
dq_1512,patient_count,com_us_lake,dagg_bax_dispense_file,order_transaction_number,"with tmp (select abs(((cur_cnt-prv_cnt)/metric)*100) as metric from (select sum(cur_cnt) as cur_cnt,field_name from (select count(distinct LH_PAT_ID) as cur_cnt, 'Unit' as field_name from (select order_transaction_number, pharmacy_name, level_1_sales_force, LH_PAT_ID, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.NPI_NUMBER = ndc.ndc_code_10digit union select order_transaction_number, pharmacy_name, level_1_sales_force, LH_PAT_ID, cmp.ship_date from com_us_lake.dagg_bax_dispense_file cmp join com_us_lake.udef_ndc_hier ndc on cmp.NPI_NUMBER = ndc.ndc_code_11digit) pa where to_date(pa.ship_date,'yyyyMMdd') between (select min(period_start_date) from com_us_lake.dq_count_table where rule_key = 1512) and (select max(period_end_date) from com_us_lake.dq_count_table where rule_key = 1512) and upper(level_1_sales_force) = 'HEMATOLOGY' group by extract(month from to_date(pa.ship_date,'yyyyMMdd')), extract(year from to_date(pa.ship_date,'yyyyMMdd'))) group by field_name) cur cross join (select prv_count as prv_cnt, metric, field_name from com_us_lake.dq_count_table where rule_key = 1512) prv on cur.field_name=prv.field_name) select * from tmp",P1,10,104
final_check,final_check,corp_us_lake,generalledger_lineitems_takeda,"LOGSYS,COMP_CODE,CHRT_ACCTS,GL_ACCOUNT,FISCVARNT,FISCPER,AC_DOC_NO,ITEM_NUM","select case when round(metric,2) > threshold then 1 else 0 end as res from dq_output_table where entity_id in ('dq_911','dq_912','dq_1511','dq_1512')",P1,0,105
